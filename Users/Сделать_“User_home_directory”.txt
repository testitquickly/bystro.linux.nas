Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2023-02-03T02:00:34+02:00

====== Сделать “User home directory” ======

Нужно сделать на сервере отдельный каталог для хранения пользовательских данных. Тот же Midnight Commander (как и прочие программы)  должен куда-то записывать свои конфиги.

Каталог можно условно назвать “''users''”. 

Три раза внимательно с диском с каталогом “users”. Если он исчезнет из OMV (поломался, вынули по ошибке или заменили), при логине по ssh потеряется возможность запускать ПО от имени залогиненного юзера, пойдут ошибки “Could not chdir to home directory”. Придётся 

	1. создать нового пользователя, аналогичного основному
	2. залогиниться под новым
	3. удалить основного
	4. заново создать «основного»…

«Обновлённый» пользователь может называться теми же буквами, но у него будет другой id, и владельцем всех ранее созданных каталогов на дисках будет оставаться пользователь со старым id. Если упустить этот момент и не переназначить права на владение каталогами для юзера «со старым названием и новым id», позже могут возникнуть непонятные сложности с записью в каталоги, и подсказки не будет.

Было бы здраво сделать каталог для настроек пользователей прямо на /dev/sda, бо это диск, который «случайно» не вынуть. Но в OMV shares на основном диске системы невозможны. Однако есть хитрый способ:
* файлы профилей юзеров будут находиться на /dev/sda1 в ''/home/users''.
* shared folder для профилей юзеров будет находиться на (например) /dev/sdd1, на котором будет сделан симлинк на в ''/home/users/''.

Эта схема безопаснее — даже если диск /dev/sdd1 умрет или будет заменен, каталог с профилями пользователей останется на месте, на новом диске будет достаточно снова сделать симлинк.

===== Сделать каталог для профилей =====

На всякий случай убедиться в том, что на nas сейчас больше никто не залогинен по ssh.

Зайти на NAS по ssh под ''root'':

''su''

''mkdir /home/users/''

'''
chown astenix:sudo -R /home/users/
'''

Повторить последнюю команду для всех юзеров на сервере.

===== Сделать симлинк на каталог с профилями =====

Перейти на HDD, на котором будет создана share для каталога с файлами пользовательских профилей. Например — /dev/sdd1

''ln -s /home/users/''

===== Сделать shared folder в OMV для всех пользователей =====

В браузере в OMV залогиниться под админом.

''Storage'' 
''> Shared Folders''

Создать новый Shared Folder на /dev/sdd1

* Name: ''users''
* File system: ''/dev/sdd1''
* Relative path 
	* > Browse directory 
	* > выбрать каталог ''users/'' (на самом деле это симлинк)
* Permissions = Administrator: read/write, Users: read/write, Others: no access
* [Save]

Зайти в //Permissions// для этого каталога и поставить галочками права Read/Write для юзеров и групп.

Зайти в ACL (Access Control List — список управления доступом) для этого каталога и поставить галочками Read/Write для юзеров:
* Group = users > Read/Write/Execute
* Others = none
* Recursive = Apply

===== Назначить его как «User home directory» =====

''Users'' 
''> Settings'' 
''> User home directory''
''> Enabled'' 
''> Location = выбрать появившийся Shared Folder «users»''
''[Save]''

==== Изменить настройки основного пользователя ====

под которым будем заходить на NAS

''Users'' 
''> Users''
''> тыкнуть по существующему юзеру (например «astenix»)''
''> [Shared folder permissions]'' 
''> в списке доступных каталогов должен появиться «/users»'' 
''> тыкнуть по нему и по кнопке [Read/Write]'' 
''> [Save]''

новые настройки должны подхватиться.

В крайнем случае придётся создать нового «постоянного» пользователя.

===== Раскрасить терминал =====

В каталоге пользователя в файле ''.bashrc'' добавить инструкции:

1) Убрать комментарий у строки 

''force_color_prompt=yes''

2) Найти эту строку:

''PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '''

Заменить её на 

''PS1='${debian_chroot:+($debian_chroot)}\[\033[38;5;214m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '''

Теперь имя пользователя (\u) будет отображаться оранжевым.

	А так — светло-красным:

	''PS1='${debian_chroot:+($debian_chroot)}\[\033[1;31m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '''

3) Чтобы применить изменения надо или перелогиниться, или 

''source ~/.bashrc''

//Next step//: [[Добавить пользователей]]
