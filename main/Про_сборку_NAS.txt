Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2023-01-31T14:41:11+02:00

====== Про сборку NAS ======

Единственно правильного подхода для сборки NAS нет. Сегодня мой NAS безупречно работает на «refurbished» сервере, и мне норм. Завтра — посмотрим. 

Больше эмоций расходуется на воображение о том, как можно будет применить «свой NAS». NAS можно собрать и на мощном компьютере, на хрипящем старом компьютере, и на маленьком „Raspberry”. Можно собрать всё самостоятельно. Можно взять готовое решение от Synology, QNAP, NetGear или HP.

	Можно «поднять» усечённый и маленький, но всё-таки NAS на каком-нибудь современном роутере, на борту которого встроены Samba-сервер, VPN-сервер, брандмауер, торренты и медиа-сервер (DLNA) — базово вся функциональность не очень производительного, но всё-таки NAS за €200.

Но собирать NAS надо только под текущие задачи. Когда задачи поменяются, можно будет поменять/обновить и NAS.

Изначально мне казалось, что мой NAS будет работать 24/7, с доступом «извне», сделаю RAID-массив, всё будет красиво. Позже  оказалось, что NAS нужен только как ящик для безопасного хранения четырех HDD, на которые я спорадически скидываю или фильмы, которые считаю ценными, или условно упорядоченный, а чаще — неупорядоченный бэкап файлов с ноутбука и смартфона. Включил, скинул, выключил.

Обычно я подключал HDD к ноутбуку через док-станцию по USB, а для этого надо достать диски с места постоянного хранения (болтанка), воткнуть их в док (болтанка), временами беспокоиться о том, что они становятся заметно горячими (вентиляторов нет), волноваться о скорости передачи данных по USB и постоянно опасаться их задеть, пока работают, или вообще столкнуть их со стола, или случайно сдёрнуть USB. Особенно опасался вероятного отключения электричества. Есть бесперебойник, но… Затем выдергивать их из дока (опять болтанка), ложить обратно… постоянно рискуя уронить.

В NAS диски находятся постоянно в одном положении. Не столкнёшь даже случайно. Их обдувает вентилятор с необычно широкими лопастями, они ещё ни разу не кипятились до температур, которые бывали при подключении в док-станцию. В OMV есть встроенное ПО, которое может грамотно погасить NAS, если электричество отключится и ИБП начнёт предсмертно пищать.

Держать на NAS свою почту, календарь и любые веб-сервисы можно, но не нужно, бо это надо уметь защитить.

	Вряд ли мне взломают сам NAS, вероятнее всего, когда-то будет взломан мой роутер, а уже с него откроется доступ к домашним устройствам.

Вообще, оказывается, что

	* работать сутками NAS незачем. И если hdd работают редко, то их жизненный цикл — не меньше семи лет. Есть смысл раз в год проверять каждый диск на ошибки;
	* можно настроить доступ к NAS из внешней сети, но при этом надо будет подумать про безопасность — [[Защита NAS]], а это сложно, открытый всему миру источник неизбежно будет взломан;
	* нет нужды смотреть фильмы //только// на большом экране с объёмным звуком. Большинство из них — временные файлы, которые проще и удобнее посмотреть/перемотать на ноутбуке, да в наушниках, а потом удалить (то же и с сериалами). Поэтому поднимать [[Docker:Импорт контейнеров:Plex]] на NAS можно, но не нужно (вообще не рекомендуется);
	* смотреть фильмы по сети с NAS можно, но сперва надо заняться параметрами домашней сети. Маленькие файлы «ходят» незаметно по любой сети, а файлы на 20 Gb по сети не каждый телевизор/смартфон потянет. Иногда проще перекатать кино на usb и воткнуть его в телевизор, или использовать tv-box на Android;
	* много RAM в NAS не нужно. Лучше подумать в сторону ускорения скорости передачи данных по LAN;
	* но если всё же организовать свой DLNA, то в NAS понадобятся и памяти побольше, и отдельная видеокарта (не всякая), и опять же надо посмотреть, если можно улучшить скорость в сети — или новый роутер подороже, или перетряхнуть настройки существующего (и ничего не поломать). Встроенный в OMV сервер DLNA очень примитивный, быстро захочется Kodi или Plex или JellyFin с постерами и подтягиванием описания фильмов из общей базы кино, а им нужны мощные процессоры для транскодинга, что в NAS нереалистично;
	* RAID нужен не всем и не всегда. Он нужен не для обеспечения надёжности или хранения, а обеспечения постоянного доступа к файлам, когда к серверу часто обращаются разные юзеры — это офисные условия. Для хранения мусорного бытового набора типа «домашнее файлО» RAID избыточен;
	* если умрет hdd с набором общедоступных фильмов — это будет досадно, но не более, жизнь от этого не остановится, бо фильмы эмоционально важны, но в быту — не нужны. Да и постеры с описаниями к фильмам тоже нах не нужны;
	* ~~если~~ когда с массивом что-то произойдёт, надо быть рядом и уметь чинить;
	* объёмные hdd на 10 Tb кажутся отличным решением — они БАЛЬШИЕ. Но они очень заметно шумные (7200 rpm). Надо настроить HDD на остановку блинов, если к нему десять минут никто не обращается;
	* ssd кажутся отличным решением — бесшумные, плоские. Но объёмные стоят дорого. И умирают ssd как-то СРАЗУ и непредсказуемо, что новые, что старые. HDD склонны предупреждать о своей смерти заранее (шуршание, скрипы, свист);
	* незачем шифровать hdd, если на нём нет ничего нелегального;
	* не факт, что самосборный NAS будет дешевле готового «ящика» от, например, Synology.

===== OMV как отдельный сервис в системе Debian =====

Это можно, хотя OMV — это не сервис, а полноценный отдельный дистрибутив на базе Debian, который предназначен для полного управления доверенного ему компьютеру в качестве NAS. Возможно, разумно поднять его в докер-контейнере.

Опционально

''sudo apt install wget curl'' 

==== Добавить репозиторий OpenMediaVault ====

''echo "deb https://packages.openmediavault.org/public stoneburner main" | sudo tee /etc/apt/sources.list.d/openmediavault.list''

==== Импорт ключей репозитория ====

''wget -O - https://packages.openmediavault.org/public/archive.key | sudo apt-key add -''

==== Установить OpenMediaVault ====

''sudo apt update && sudo apt upgrade && sudo apt install openmediavault''

==== Настроить OMV через веб-интерфейс ====

 ''http://<IP_адрес_вашего_сервера>''

и дальше настраивать — [[Установка OMV:Настроить OMV через веб-интерфейс]]

//Next step//: [[Установка OMV:Про установку OMV]]
