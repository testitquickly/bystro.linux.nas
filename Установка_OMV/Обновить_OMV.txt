Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2023-01-31T14:45:24+02:00

====== Обновить OMV ======

Выполнить на NAS проверку того, что действующий OMV и все его настройки в норме и готов к обновлению.

''sudo omv-salt stage run deploy''

Терпеливо дождаться ответа. 

Пример ответа:

''Summary for debian''
''Succeeded: 2 (changed=2)''
''Failed:    0''

===== Обновление OMV =====

	Но если это дебиан, то не будет логичным сделать '''apt-get update && apt-get upgrade && apt dist-upgrade'''?

	Нет.

	„OMV” работает на устаревшем стабледебе, и это правильно. dist-upgrade принесёт обновления из других репозиториев, и OMV почти однозначно разломается, решением будет только переустановка с нуля.

	В принципе можно проверить содержимое ''cat /etc/apt/sources.list'' на адекватное содержимое.

1

''sudo omv-upgrade''

Если есть ошибки — остановиться и гуглить решения.

	Пример ошибки — [[https://www.cyberciti.biz/faq/the-repository-http-deb-debian-org-debian-buster-backports-release-no-longer-has-a-release-file/|The repository 'http://deb.debian.org/debian buster-backports Release' no longer has a Release file]].

	Когда всё починено — повторить ''sudo omv-upgrade''

2

Это обновление до нового крупного релиза.

''sudo omv-release-upgrade''

Если есть ошибки — остановиться и гуглить решения. Единственное предупреждение, которое нас не напрягает, это «error message from patch which says a patch has alredy been applied», это можно игнорироватью

Дождаться отработки всех скриптов. 

Reboot.

3

В браузере сделать принудительный refresh (Crtl+F5)

Протыкать последовательно все включенные сервисы и docker containers. Если что-то не будет работать, или если будут сообщения про Linux image Updates, которое невозможно установить/обновить через GUI — вернуться в консоль и снова выполнить ''omv-upgrade''.

В будущем разумно обновляться только из веб-интерфейса.

===== Суровый апгрейд =====

Хардкорный апгрейд на стороне сервера может понадобиться, ~~если~~ когда сделал какую-то глупость или можно/нужно обновить сам Debian.

На сервере:
1. залогиниться как root
2. [ОПЦИОНАЛЬНО, но полезно] ''omv-firstaid > выбрать “clean-apt”''
3. ''omv-upgrade''

Получить все обновления.

На ноуте:
1. в браузере залогиниться в OMV
2. пройти в System > Update Management > Updates
3. убедиться в том, что ничего не предлагается к обновлению

На сервере:
1. reboot
2. убедиться в том, что после перезагрузки всё в норме

//Next step//: [[Базовая настройка сервера]]
