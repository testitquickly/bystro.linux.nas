Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2025-08-21T20:43:20+03:00

====== Загрузить Debian Live с USB ======

===== Сделать Live Debian USB =====

Взять 
* чистую USB-flash от 4Gb или DVD.
* iso-образ Debian Live
	* https://www.debian.org/CD/live/
	* или в архиве https://archive.org/download/debian-12-bookworm-collection/12.11/Debian%20Live%20%28amd64%29/

==== Накатить образ на флэшку ====

Есть грубо-однозначные установщики образов iso на очень маленькие флэшки

* Software:Unetbootin
* Debian:Install:Balena etcher

Они воспринимают любую флэшку как «одну единицу чего-то» и накатывают на неё образ Debian одним движением, делая флэшку read only. Для образа нужно 3 или 4 Gb, и если флэшка будет размером с 30 Gb, то 

* будет размечена нужная область на 4 Gb
* и добавлен небольшой служебный раздел на несколько Mb
* а всё остальное будет и неразмечено, и в принципе недоступно. Если будет нужно какие-то скрипты взять на борт флэшки, то уже нет.

Но можно сделать всё вручную в консоли.

==== Подготовка ====

Разумно сперва отформатировать флэшку и оставить на ней одну партицию, чтобы она идентифицировалась однозначно. Это можно сделать через «Диспетчер разделов от KDE» или GParted:

* воткнуть флэшку в ноут, но не монтировать ее партицию.
* «Диспетчер разделов от KDE» > найти устройство, и если есть разделы > протыкать каждый и выбрать Delete > Применить.
* найти флэшку в консоли

''lsblk''

Пример ответа:

''sda  8:0    1    30G  0 disk'' 

Аккуратно смотреть все пути, чтобы случайно не затереть другие партиции.

Условно:

* путь к партициям на флэшке: ''/dev/sda''
* путь к образу iso: ''/home/astenix/Install/Debian/debian-live-12.11.0-amd64-kde.iso''

==== Записать ISO на флешку ====

''sudo dd if=/home/astenix/Install/Debian/debian-live-12.11.0-amd64-kde.iso of=/dev/sda bs=4M status=progress conv=fsync''

==== Добавить место для файлов ====

Проверить свободное пространство на флэшке.

''sudo parted /dev/sda print free''

или

''sudo fdisk -l /dev/sda''

Скорее всего, после записи iso на флешке появится старый DOS MBR (msdos) раздел, и свободное место будет отображаться некорректно. Например, 128 Gb вместо реальных 30 Gb:

''Start=8288kB, End=129GB''

Можно проверить свободное место через «Диспетчер разделов от KDE». Однако создать партицию на неразмеченном месте там же будет невозможно.

Вот надежный способ:

''sudo fdisk /dev/sda''

Дальше надо последовательно ввести команды (одна клавиша):

* ''n'' (new partition)
* ''p'' (Primary, выбор типа раздела для выбранного диска)
* 3 ''(''цифра, номер раздела, в котором будет создана новая партиция; по умолчанию следующий свободный, может быть несколько свободных)
* указать ''First sector'': просто нажать Enter
* указать ''Last sector'': тоже Enter (подразумевается, что просто создаем новую партицию на все доступное свободное место)

Дождаться сообщения вроде

''Created a new partition 3 of type 'Linux' and of size 26,7 GiB.''

* ''w'' (write and exit)

Проверить результат:

''lsblk -f''

Если отображается партиция ''sda3'' — все ок.

Создать новый раздел в формате fat32 на свободном пространстве и задать ему метку “''myFiles''”:

''sudo mkfs.vfat -F32 -n myFiles /dev/sda3''

Монтируем его:

''sudo mkdir -p /mnt/myFiles && sudo mount /dev/sda3 /mnt/myFiles''

Учесть, что запись доступна только для sudo. Назначить владельца для партиции FAT32 невозможно, поэтому 

''sudo mc'' 

Перенести нужные файлы.

Отмонтировать партицию:

''sudo umount /mnt/myFiles'' 

Флэшка с Debian Live готова.

Её можно воткнуть в NAS и оставить её там навсегда, и даже можно примонтировать раздел с неё внутри OMV.

===== Настроить загрузку NAS =====

На моем микросервере от HP в BIOS заходят через нажатие кнопки [F10] на экране «Post prompts». BIOS проприетарный и древний, поэтому у него есть нюансы:

* SSD с OMV — определяется как HDD под именем «''PS-Apacer…''»
* USB с Debian Live — определяется как «''USB:SCSI Disk''»

Конечно, определяются не сами диски, а их партиции. 

=== Настройки «Boot Device Priority» ===

Неочевидно, но смена дисков для загрузки настраивается в разделе ''Hard Disk Drives'', поэтому в разделе ''Boot Device Priority'' можно всё настроить один раз и больше туда не заходить.

''BIOS'' 
''> Boot''
''> Boot Device Priority''

1st = ''HDD:PS-Apacer…''
2nd = ''Network:MBA…''
3d = ''DISABLED''

==== Конфигурация загрузки NAS с USB Debian Live ====

''BIOS'' 
''> Boot''
''> Hard Disk Drives''

1st = ''USB:SCSI Disk''
2nd = ''HDD:PS-Apacer…''

В «''Boot Device Priority''» заходить не надо, там значения поменяются сами согласно настройкам из раздела «''Hard Disk Drives''».

[''F10'']

==== Загрузиться в Debian Live ====

На экране с опциями поставить курсор на первую строку

''Live system (amd64)''

Если просто тыкнуть Enter — будет загружен Debian с KDE. Если к нас не подключена мышь, жить в GUI можно, но через какое-то время экран погаснет и сессия заблокируется (пароль: live), а разблокировать её можно только движением мыши.

Поэтому сразу заходим в консоль.

* Курсор на первой строке

''Live system (amd64)''

* Нажать Tab. Появится редактируемая строка с настройками загрузки образа системы: 

''.linux /live/vmlinuz boot=live components quiet splash initrd=/live/initrd.img''

* Убрать «''components quiet splash''»
* Добавить «''init=/bin/bash''»

''.linux /live/vmlinuz boot=live init=/bin/bash initrd=/live/initrd.img''

* Нажать ENTER

Быстро загрузится сессия, которая обычно называется “Resque mode”:

''root@(none):/#''

В ней нет сети, udev, GUI, systemd и каких-то общих демонов, которые нужны при нормальной работе системы. Чистый bash.

Или можно дождаться загрузки KDEGui, затем через ctrl+alt+F2 открыть отдельный терминал, но это тупо, через какое-то время включится power off и экран логина (пароль: live), но без шевеления мышки он не появится.

* Глянуть диски: 

''lsblk -f'' (так будут видны labels партиций)

* Найти флэшку с Debian Live и партицию с файлами. Например, она будет определена как /''sdg3''
* Примонтировать её в каталог ''/mnt''

''mount /dev/sdg3 /mnt''

Проверить, что все хорошо и файлы доступны: ''ls /mnt''

* Запуск скрипта из примонтированного раздела (мне вся эта Debian Live была нужна для того, чтобы выполнить fsck по всем HDD, когда они не примонтированы):

''bash /mnt/check_hdd.sh''

Если надо его отредактировать:

''nano /mnt/check_hdd.sh''

Если что, там: 

Ctrl+O — записать изменения
Ctrl+X — выйти из редактора

* Выключить компьютер: сперва сделать сброс кэша на все подключенные диски, затем отключить

'''
sync; poweroff
'''

или 

'''
sync; shutdown -h now
'''

На самом деле сейчас надо вернуть нормальную конфигурацию загрузки NAS.

==== Конфигурация загрузки NAS с внутреннего SSD ====

''BIOS'' 
''> Boot''
''> Hard Disk Drives''

1st = ''HDD:PS-Apacer…''
2nd = ''USB:SCSI Disk''

В «''Boot Device Priority''» заходить не надо, там значения поменяются сами согласно настройкам из раздела «''Hard Disk Drives''».

[''F10'']
