Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2023-02-01T00:50:02+02:00

====== Восстановить RAID-массив ======

Хе-хе, это было неизбежно…

Не надо сразу создавать новый массив из старых дисков. Это может сработать, а может и нет. Вообще, при потере информации на RAID надо прекратить любую запись на диски и заняться выуживанием данных. И ребилдить только ПОСЛЕ бэкапов.

Лечение зависит от того, что засбоило — диск или RAID-контроллер (или сперва что-то одно, а затем другое), а также от типа RAID-массива, поэтому в них надо разбираться отдельно, предварительно и самостоятельно. А также от собственной беспечности в отношении бэкапов. И от решения держать диски зашифрованными или нет.

Если просто «умер» один из дисков, но данные всё ещё есть, и всего лишь падает скорость записи/чтения данных, то общий алгоритм немедленных действий таков:

1. сделать бэкап того, что есть (для этого нужны другие диски достаточной ёмкости, которые постоянно должны быть в запасе…),
2. пока идёт бэкап, СПОКОЙНО попытаться определить источник неполадок: контроллер или диски, бо от этого зависят следующие шаги,
3. заменить умирающий hdd (держать новый про запас, и не один…),
4. сделать ребилд массива.

Если сразу броситься делать ребилд, то высок риск напороться на ранее незаметный бэд-блок на любом из дисков, и контроллер не сможет вычитать информацию из сектора. После долгих часов ожидания останется только ресетнуть компьютер и помянуть потерянные данные. Sad, but true.

	Отказ может произойти из-за того, что нескольких дисков одновременно переходят переход в режим off-line, массив не стартует и данные не отдает. Вероятно, на дисках уже накопились бэд-блоки. Или контроллер руководствуется диагностикой S.M.A.R.T. и определяет диск как «мертвый».

	Бывает, что после смерти одного из дисков контроллер неверно обрабатывает ситуацию и массив либо перестает корректно работать, либо становится недоступным чуть более, чем полностью. Это может произойти даже во время перестроения/восстановления массива. Иногда падение дисков происходит почти последовательно. Никто не обещал, что будет легко.

	Контроллеры бывают программные (простейшее и худшее решение, где всё делает процессор сервера), или встроенные в материнскую плату, или в виде отдельных плат (можно заменять) или даже внешних устройств с собственным процессором (дорого-богато, чуть надёжнее и проще в обслуживании). В зависимости от его типа надо принимать те или иные решения.

Если данные очень важны — лучше не экспериментировать и отнести диски в специализированные конторы, работники которых с интересом посмотрят всё их содержимое. Ну да, ну да, мы же не для того поднимали NAS в домашних условиях…

//Next step//: [[Добавить SSD:TRIM для SSD]]
