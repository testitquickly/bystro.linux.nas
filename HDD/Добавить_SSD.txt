Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2024-11-06T18:21:58+02:00

====== Добавить SSD ======

Если к SSD диску будет немного обращений, то, вероятно, TRIM ему и не нужен. Да и сперва надо точно знать, поддерживает ли он TRIM. 

Но если надо попытаться оптимизировать его производительность и долговечность, то включить TRIM для SSD надо непременно.

См. также [[Установка OMV:Установить OMV#Включить TRIM для SSD]]

Установка SSD такая же, как и HDD:
* воткнуть диск куда можно
* ''Storage > File Systems > Mount an existing file system''

===== Настроить trim для SSD =====

Надо учесть, что в OMV 
* для //системного// SSD это делается через ''/etc/fstab'' (классический подход в Debian)
* а для всех //подключаемых// SSD это делается //только// через файл ''/etc/openmediavault/config.xml'' — значения из него принудительно дописываются в ''/etc/fstab''

Делать всё или из-под ''root'', или из-под ''sudo''-юзера.

==== Сделать бэкап ====

''sudo cp /etc/openmediavault/config.xml /etc/openmediavault/config.xml.backup''

==== Отредактировать „config.xml“ ====

''sudo mcedit /etc/openmediavault/config.xml''

Найти секцию “''mntent''” для добавленного диска (их несколько — по одной на каждый диск). Перепровериться тридцать три раза.

	Затем ещё один раз.

Найти строку, которая начинается с ''<opts>''. 

В найденной строке 

	1. аккуратно убрать параметр:

	''defaults''

	2. добавить новые параметры:

	''discard,noatime,nodiratime,''

Получится вот такая строка

''<opts>discard,noatime,nodiratime,nofail,user_xattr,acl<opts>''

Объяснение:

''discard''
	включает TRIM для SSD, что позволяет операционной системе периодически сообщать диску, какие блоки данных больше не используются. Это помогает поддерживать производительность SSD и предотвращает его излишний износ. Однако, если на вашем SSD поддерживается автоматический TRIM, этот параметр может быть лишним.

''noatime''
	отключает обновление времени последнего доступа к файлам (atime) при чтении, что уменьшает количество операций записи и повышает производительность. Это особенно полезно для SSD, где количество циклов записи ограничено.

''nodiratime''
	аналогично noatime, но применяется только к директориям. Это также снижает количество операций записи.

''nofail''
	указывает системе продолжить загрузку, даже если монтирование этого устройства не удалось. Полезно для внешних или несущественных накопителей, чтобы при их отсутствии загрузка не прерывалась.

''user_xattr''
	разрешает использование расширенных атрибутов на уровне пользователя (например, для хранения метаданных файлов). Расширенные атрибуты могут быть полезны для программ, которые используют специфические метаданные.

''acl''
	включает поддержку списков контроля доступа (ACL) в OMV, которые позволяют задавать более тонкие права доступа для пользователей и групп.

Сохранить и выйти из редактора.

==== Принудить OMV перечитать обновленный файл с настройками ====

Под своим юзером 

''sudo omv-salt deploy run fstab'' 

Диски будут отмонтированы.

Ожидаемый ответ:

''Succeeded: ЧИСЛО (changed=6)''
''Failed:     0''

Если Failed = 0 — всё хорошо.

Reboot.

//Next step//: [[HDD]]
