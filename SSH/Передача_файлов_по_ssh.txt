Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2023-02-03T19:22:23+02:00

====== Передача файлов по ssh ======

Для регулярного бэкапа надо использовать возможности [[Бэкапы:RSync]], а там только ssh и нужно, всё должно работать в фоновом режиме.

Для обычного перекачивания файлов (кино и изображения) с/на NAS можно как через //Krusader// или через //Midnight Commander.//

===== Krusader =====

Сервис > Новое сетевое соединение (Ctrl+N): 
	* smb 
	* ftp
	* sftp
	* fish (File transfer over Shell)
	* nfs
	* webdav 

===== Midnight Commander =====

В теории подключиться к NAS по ssh можно через F9 > Левая/Правая Панель:
	* shell (ssh) 
	* ftp
	* sftp

с авторизацией в виде 

''user@host:port''

==== Проблема с аутентификацией по публичному ssh-ключу ====

Есть ситуация, когда такое подключение через MC невозможно — например, когда авторизация происходит по публичному ssh-ключу с указанием его нестандартного расположения через параметр “-i”.

	См. пример «[[Подключиться к NAS по ssh#Подключение с указанием определенного ключа|Подключиться к NAS по ssh с указанием определенного ключа]]».

О причине отказа подключения догадаться невозможно — MC просто отказывается подключаться безо всяких подсказок. 

//**Решение**//
Использовать для подключения отдельный конфигурационный файл в стандартном каталоге расположения ssh-ключей в профиле пользователя. 

По-умолчанию этого файла нет, поэтому его можно сразу и создать:

''mcedit ~/.ssh/config''

Записать в этот файл расположение личного ssh-ключа, username на NAS (login) и hostname (адрес NAS). И порт, если нужно. И алиас этого подключения, например, ’myNAS’:

''Host myNAS''
''HostName 192.168.10.20''
''Port 81''
''User login''
''IdentityFile /home/ssh_keys/nas/nas_login.private.key''

Ограничить доступ к конфигурационному файлу только для своего пользователя:

''chmod 600 ~/.ssh/config''

В Midnight Commander выполнить стандартное подключение:

''> F9'' 
''> Левая/Правая Панель''
''> shell (ssh)''
''> указать имя подключения (’myNAS’)''

Отныне то же самое можно делать не через F9, а командой

'''
cd sh://myNAS
'''

Или даже 

'''
ssh myNAS
'''

Если надо сразу после логина перейти в какой-то каталог, можно сделать alias для подключения в .bashrc, а можно при подключении полностью указать каталог, куда надо зайти:

''myNAS/home/all_user_settings''

Выглядит не очень, но удобно, что всё это сохраняется. И ещё можно сделать на стороне  NAS короткие ссылки на длинные пути… 

=== Неочевидное решение проблемы ===

Скорее всего, подключение к ноутбуку по ssh тоже возможно, но авторизация только по личному ключу не настроена, бо кому это надо?

Поэтому можно зайти по ssh в обратную сторону — со стороны NAS на ноутбук.

1. в консоли на ноутбуке выполнить стандартное [[Подключиться к NAS по ssh#Подключение к NAS по ssh|Подключиться к NAS по ssh]]
2. в консоли на стороне NAS запустить ”mc”
3. в MC на стороне NAS пройти в ‘F9 
	a. > Левая/Правая Панель‘ 
	b. > Shell-соединение 
	c. > указать IP ноутбука 
	d. > логин/пароль

Но лучше так не делать.

==== Настройки нескольких подключений ====

В этом конфигурационном файле можно расписать настройки подключения для нескольких хостов. Пример:

''Host dev.myNAS''
	''HostName dev.example.com''
	''User developer''
	''Port 2322''

''Host test.myNAS''
	''HostName test.example.com''
	''User tester''
	''Port 2322''

Если надо подключиться к myNAS не под прописанным юзером ’login’, то надо указать имя отдельным параметром:

''ssh -o "User=bobby" myNAS''

//Next step//: [[main]]
